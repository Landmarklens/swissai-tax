# Canton Tax Form Templates

This directory stores official PDF form templates from all 26 Swiss cantons.

## Directory Structure

```
canton_forms/
├── ZH/
│   ├── ZH_2024_de.pdf          # Zurich form (German)
│   ├── ZH_2024_fr.pdf          # Zurich form (French)
│   └── field_analysis.json     # PDF field structure analysis
├── GE/
│   ├── GE_2024_fr.pdf          # Geneva form (French)
│   ├── GE_2024_en.pdf          # Geneva form (English)
│   └── field_analysis.json
├── BE/
│   ├── BE_2024_de.pdf
│   ├── BE_2024_fr.pdf
│   └── field_analysis.json
... (all 26 cantons)
```

## Form Collection Process

### Step 1: Download Official Forms

Each canton publishes official tax return forms on their cantonal tax website. URLs are documented in `canton_form_metadata.py`.

**Download script:**
```bash
# Run the form download script
python scripts/download_canton_forms.py --year 2024
```

This script:
- Downloads forms from official canton websites
- Saves forms in language-specific versions
- Logs download status and any errors

### Step 2: PDF Field Analysis

Once forms are downloaded, analyze their fillable field structure:

```bash
# Analyze PDF form fields
python scripts/analyze_pdf_fields.py --canton ZH
```

This generates `field_analysis.json` for each canton containing:
- List of all fillable fields
- Field types (text, number, checkbox, date)
- Field positions and sizes
- Field validation rules

### Step 3: Field Mapping Verification

Verify that our field mappings in `canton_form_mappings.py` match the actual PDF fields:

```bash
# Verify field mappings
python scripts/verify_field_mappings.py --canton ZH
```

This checks:
- All mapped fields exist in the PDF
- Field types match expectations
- No critical fields are missing

## Form Versions

Canton forms are updated annually. The directory structure includes the tax year:

- **2024 forms**: Current implementation
- **2025 forms**: To be added in Q4 2024
- **Backwards compatibility**: Keep previous year forms for late submissions

## Legal Compliance

### Copyright Notice

Canton tax forms are official government documents. Their use is permitted for:
- ✅ Filing tax returns
- ✅ Educational purposes
- ✅ Software development for tax filing assistance

**NOT permitted:**
- ❌ Commercial redistribution
- ❌ Modification of official forms
- ❌ Use outside of Swiss tax filing context

### Data Privacy

When filling canton forms with user data:
- 🔒 All user data must be encrypted in transit and at rest
- 🔒 Completed PDFs must be securely transmitted or stored
- 🔒 User consent required before submitting to canton authorities
- 🔒 GDPR compliance mandatory

## Canton-Specific Notes

### Zurich (ZH)
- Most comprehensive form (147 fields, 16 pages)
- Supports eCH-0196 barcode submission
- Electronic submission via ePortal

### Geneva (GE)
- International city - English version available
- French primary language
- 142 fields, 16 pages

### Zug (ZG)
- Low-tax canton
- Popular with expatriates
- Simplified form structure

### Ticino (TI)
- Italian-speaking canton
- Unique tax structure
- Form structure differs significantly from German cantons

### Graubünden (GR)
- Only canton with Romansh language forms
- Trilingual: German, Italian, Romansh
- Complex due to multiple language versions

## Integration with SwissAI Tax

### PDF Filling Workflow

1. User completes tax interview
2. System calculates taxes using `enhanced_tax_calculation_service.py`
3. System maps data to canton fields using `canton_form_mappings.py`
4. System fills official PDF form using `traditional_pdf_filler.py`
5. User downloads pre-filled PDF
6. User reviews, signs, and submits to canton

### Dual PDF Strategy

SwissAI Tax generates TWO PDF types:

1. **eCH-0196 PDF** (Modern)
   - Machine-readable with Data Matrix barcode
   - Accepted by all 26 cantons
   - Faster processing
   - Generated by `ech0196_pdf_generator.py`

2. **Traditional Canton Form** (Official)
   - Official canton-specific PDF form
   - Pre-filled with user data
   - Familiar to users and tax authorities
   - Generated by `traditional_pdf_filler.py` (Phase 4 Week 8)

Users can download both and choose their preferred submission method.

## Testing

### Test Form Download
```bash
pytest tests/test_canton_form_download.py
```

### Test Field Mapping
```bash
pytest tests/test_canton_form_mappings.py
```

### Test PDF Filling
```bash
pytest tests/test_traditional_pdf_filler.py
```

## Maintenance

### Annual Update Process (Q4 each year)

1. Check canton websites for updated forms
2. Download new year forms
3. Run field analysis on new forms
4. Update field mappings if canton changed field names
5. Update `canton_form_metadata.py` with new URLs and versions
6. Test PDF filling with new forms
7. Deploy before January 1st of tax year

### Form Change Monitoring

Set up automated monitoring:
```bash
# Weekly check for form updates
python scripts/monitor_canton_forms.py --notify
```

Sends alerts if:
- Canton publishes updated form
- Field structure changes
- New fields added
- Fields removed

## Support

For canton-specific form questions:
- Check canton tax website (URLs in `canton_form_metadata.py`)
- Contact canton tax administration
- Swiss Federal Tax Administration: https://www.estv.admin.ch/

For technical issues:
- GitHub: https://github.com/anthropics/swissai-tax/issues
- Email: support@swissai.tax

---

**Last Updated:** 2024-10-06
**Form Year:** 2024
**Cantons Supported:** 26/26
